<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2017-08-09 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>r43ples - CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20170809" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                r43ples
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-08-09</span>
                  &nbsp;| <span id="projectVersion">Version: 0.8.8</span>
                      </div>
            <div class="xright">                    <a href="./" title="r43ples">r43ples</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                          <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                              <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="testapidocs/index.html" title="Test JavaDocs">Test JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="dependency-analysis.html" title="Dependency Analysis">Dependency Analysis</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
            <strong>CPD</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD">PMD</a>
            </li>
                      <li class="none">
                          <a href="taglist.html" title="Tag List">Tag List</a>
            </li>
                      <li class="none">
                          <a href="cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2>CPD Results<a name="CPD_Results"></a></h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.6.1.</p></div>
<div class="section">
<h2>Duplications<a name="Duplications"></a></h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>de/tud/plt/r43ples/merging/MergeManagement.java</td>
<td><a href="./xref/de/tud/plt/r43ples/merging/MergeManagement.html#L713">713</a></td></tr>
<tr class="a">
<td>de/tud/plt/r43ples/merging/MergeManagement.java</td>
<td><a href="./xref/de/tud/plt/r43ples/merging/MergeManagement.html#L911">911</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>		String graphNameOfBranchB = graph.getReferenceGraph(commit.branchNameB);
		
		if (type.equals(MergeQueryTypeEnum.MANUAL)) {
			// Manual merge query
			RevisionManagement.executeINSERT(graphNameOfMerged, commit.triples);
		} else {	
			// Copy graph B to temporary merged graph
			String queryCopy = String.format(&quot;COPY &lt;%s&gt; TO &lt;%s&gt;&quot;, graphNameOfBranchB, graphNameOfMerged);
			TripleStoreInterfaceSingleton.get().executeUpdateQuery(queryCopy);
			
			// Get the triples from branch A which should be added to/removed from the merged revision
			String triplesToAdd = &quot;&quot;;
			String triplesToDelete = &quot;&quot;;
			
			// Get all difference groups
			String queryDifferenceGroup = prefixes + String.format(
					  &quot;SELECT ?differenceCombinationURI ?automaticResolutionState ?tripleStateA ?tripleStateB ?conflict %n&quot;
					+ &quot;WHERE { GRAPH &lt;%s&gt; { %n&quot;
					+ &quot;	?differenceCombinationURI a rpo:DifferenceGroup ; %n&quot;
					+ &quot;		sddo:automaticResolutionState ?automaticResolutionState ; %n&quot;
					+ &quot;		sddo:hasTripleStateA ?tripleStateA ; %n&quot;
					+ &quot;		sddo:hasTripleStateB ?tripleStateB ; %n&quot;
					+ &quot;		sddo:isConflicting ?conflict . %n&quot;
					+ &quot;} }&quot;, graphNameDifferenceTripleModel);
	
			// Iterate over all difference groups
			ResultSet resultSetDifferenceGroups = TripleStoreInterfaceSingleton.get().executeSelectQuery(queryDifferenceGroup);
			while (resultSetDifferenceGroups.hasNext()) {
				QuerySolution qsCurrentDifferenceGroup = resultSetDifferenceGroups.next();
	
				String currentDifferencGroupURI = qsCurrentDifferenceGroup.getResource(&quot;?differenceCombinationURI&quot;).toString();
				String currentDifferencGroupAutomaticResolutionState = qsCurrentDifferenceGroup.getResource(&quot;?automaticResolutionState&quot;).toString();
//				Currently not needed
//				String currentDifferencGroupTripleStateA = qsCurrentDifferenceGroup.getResource(&quot;?tripleStateA&quot;).toString();
//				String currentDifferencGroupTripleStateB = qsCurrentDifferenceGroup.getResource(&quot;?tripleStateB&quot;).toString();
				boolean currentDifferencGroupConflict = qsCurrentDifferenceGroup.getLiteral(&quot;?conflict&quot;).getBoolean();
				
				// Get all differences (triples) of current difference group
				String queryDifference = prefixes + String.format(
						  &quot;SELECT ?s ?p ?o %n&quot;
						+ &quot;WHERE { GRAPH &lt;%s&gt; { %n&quot;
						+ &quot;	&lt;%s&gt; a rpo:DifferenceGroup ; %n&quot;
						+ &quot;		rpo:hasDifference ?blankDifference . %n&quot;
						+ &quot;	?blankDifference a rpo:Difference ; %n&quot;
						+ &quot;		rpo:hasTriple ?triple . %n&quot;
						+ &quot;	?triple rdf:subject ?s . %n&quot;
						+ &quot;	?triple rdf:predicate ?p . %n&quot;
						+ &quot;	?triple rdf:object ?o . %n&quot;
						+ &quot;} }&quot;, graphNameDifferenceTripleModel, currentDifferencGroupURI);
				
				// Iterate over all differences (triples)
				ResultSet resultSetDifferences = TripleStoreInterfaceSingleton.get().executeSelectQuery(queryDifference);
				while (resultSetDifferences.hasNext()) {
					QuerySolution qsCurrentDifference = resultSetDifferences.next();
					
					String subject = &quot;&lt;&quot; + qsCurrentDifference.getResource(&quot;?s&quot;).toString() + &quot;&gt;&quot;;
					String predicate = &quot;&lt;&quot; + qsCurrentDifference.getResource(&quot;?p&quot;).toString() + &quot;&gt;&quot;;
	
					// Differ between literal and resource
					String object = &quot;&quot;;
					if (qsCurrentDifference.get(&quot;?o&quot;).isLiteral()) {
						object = &quot;\&quot;&quot; + qsCurrentDifference.getLiteral(&quot;?o&quot;).toString() + &quot;\&quot;&quot;;
					} else {
						object = &quot;&lt;&quot; + qsCurrentDifference.getResource(&quot;?o&quot;).toString() + &quot;&gt;&quot;;
					}
					
					if (	type.equals(MergeQueryTypeEnum.AUTO) || 
							type.equals(MergeQueryTypeEnum.COMMON) || 
							(type.equals(MergeQueryTypeEnum.WITH) &amp;&amp; !currentDifferencGroupConflict) ) {
						// MERGE AUTO or common MERGE query
						if (currentDifferencGroupAutomaticResolutionState.equals(SDDTripleStateEnum.ADDED.getSddRepresentation())) {
							// Triple should be added
							triplesToAdd += subject + &quot; &quot; + predicate + &quot; &quot; + object + &quot; . \n&quot;;
						} else {
							// Triple should be deleted
							triplesToDelete += subject + &quot; &quot; + predicate + &quot; &quot; + object + &quot; . \n&quot;;
						}
					} else {
						// MERGE WITH query - conflicting triple
						Model model = JenaModelManagement.readNTripleStringToJenaModel(commit.triples);
						// Create ASK query which will check if the model contains the specified triple
						String queryAsk = String.format(
								  &quot;ASK { %n&quot;
								+ &quot; %s %s %s %n&quot;
								+ &quot;}&quot;, subject, predicate, object);
						Query query = QueryFactory.create(queryAsk);
						QueryExecution qe = QueryExecutionFactory.create(query, model);
						boolean resultAsk = qe.execAsk();
						qe.close();
						model.close();
						if (resultAsk) {
							// Model contains the specified triple
							// Triple should be added
							triplesToAdd += subject + &quot; &quot; + predicate + &quot; &quot; + object + &quot; . \n&quot;;
						} else {
							// Triple should be deleted
							triplesToDelete += subject + &quot; &quot; + predicate + &quot; &quot; + object + &quot; . \n&quot;;
						}
					}
				}
				// Update the merged graph
				// Insert triplesToAdd
				RevisionManagement.executeINSERT(graphNameOfMerged, triplesToAdd);
				// Delete triplesToDelete
				RevisionManagement.executeDELETE(graphNameOfMerged, triplesToDelete);
			}
		}
		
		// Calculate the add and delete sets
		
		// Get all added triples (concatenate all triples which are in MERGED but not in A and all triples which are in MERGED but not in B)
		String queryAddedTriples = String.format(
				  &quot;CONSTRUCT {?s ?p ?o} %n&quot;
				+ &quot;WHERE { %n&quot;
				+ &quot;	GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	FILTER NOT EXISTS { &quot;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>de/tud/plt/r43ples/merging/MergeManagement.java</td>
<td><a href="./xref/de/tud/plt/r43ples/merging/MergeManagement.html#L829">829</a></td></tr>
<tr class="a">
<td>de/tud/plt/r43ples/merging/MergeManagement.java</td>
<td><a href="./xref/de/tud/plt/r43ples/merging/MergeManagement.html#L1028">1028</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>				+ &quot;		GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	} %n&quot;
				+ &quot;}&quot;, graphNameOfMerged, graphNameOfBranchA);
		
		String addedTriples = TripleStoreInterfaceSingleton.get().executeConstructQuery(queryAddedTriples, FileUtils.langNTriple);
		
		queryAddedTriples = String.format(
				  &quot;CONSTRUCT {?s ?p ?o} %n&quot;
				+ &quot;WHERE { %n&quot;
				+ &quot;	GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	FILTER NOT EXISTS { %n&quot;
				+ &quot;		GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	} %n&quot;
				+ &quot;}&quot;, graphNameOfMerged, graphNameOfBranchB);

		addedTriples += TripleStoreInterfaceSingleton.get().executeConstructQuery(queryAddedTriples, FileUtils.langNTriple);
		
		// Get all removed triples (concatenate all triples which are in A but not in MERGED and all triples which are in B but not in MERGED)
		String queryRemovedTriples = String.format(
				  &quot;CONSTRUCT {?s ?p ?o} %n&quot;
				+ &quot;WHERE { %n&quot;
				+ &quot;	GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	FILTER NOT EXISTS { %n&quot;
				+ &quot;		GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	} %n&quot;
				+ &quot;}&quot;, graphNameOfBranchA, graphNameOfMerged);
		
		String removedTriples = TripleStoreInterfaceSingleton.get().executeConstructQuery(queryRemovedTriples, FileUtils.langNTriple);
		
		queryRemovedTriples = String.format(
				  &quot;CONSTRUCT {?s ?p ?o} %n&quot;
				+ &quot;WHERE { %n&quot;
				+ &quot;	GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	FILTER NOT EXISTS { %n&quot;
				+ &quot;		GRAPH &lt;%s&gt; { ?s ?p ?o } %n&quot;
				+ &quot;	} %n&quot;
				+ &quot;}&quot;, graphNameOfBranchB, graphNameOfMerged);
		
		removedTriples += TripleStoreInterfaceSingleton.get().executeConstructQuery(queryRemovedTriples, FileUtils.langNTriple);</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2017
                        <a href="http://www.et.tu-dresden.de/ifa/index.php?id=prozessleittechnik">Technische Universität Dresden - Professur für Prozessleittechnik</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
